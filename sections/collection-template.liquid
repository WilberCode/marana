{% render 'rapid-search-results-template-v2' %}
<div data-section-type="collection-template">
  {% capture header_content %}
    <nav class="breadcrumbs" role="navigation" aria-label="breadcrumbs">
      <a class="breadcrumbs__crumb" href="{{ routes.root_url }}">{{ 'general.breadcrumbs.home' | t }}</a>
      <span class="breadcrumbs__divider" aria-hidden="true">{% include 'svg-chevron-right' %}</span>
      <span class="breadcrumbs__crumb">{{ collection.title }}</span>
    </nav>

    <h1>{{ collection.title }}</h1>
    {% if collection.description != blank %}
      <div class="rte reading-width align-center large-text">{{ collection.description }}</div>
    {% endif %}
  {% endcapture %}

  {% if section.settings.header_image != blank or section.settings.head_img_coll_handled %}
    <div class="banner-image-container banner-under-header">
      {% if section.settings.head_img_coll_handled %}
        {% capture bg_url %}collection-header-{{ collection.handle }}.jpg{% endcapture %}
        <div class="banner-image fixed-height rimage__image lazyload fade-in"
            data-bgset="{{ bg_url | file_img_url: '540x' }} 540w,
                        {{ bg_url | file_img_url: '720x' }} 720w,
                        {{ bg_url | file_img_url: '900x' }} 900w,
                        {{ bg_url | file_img_url: '2048x' }} 1000w"
            data-sizes="auto"
            data-parent-fit="cover">
        </div>
        <noscript>
          <div class="banner-image fixed-height" style="background-image: url({{ bg_url | file_img_url: '2048x' }});"></div>
        </noscript>
      {% else %}
        <div class="banner-image fixed-height rimage__image lazyload fade-in"
            data-bgset="{% include 'bgset', image: section.settings.header_image %}"
            data-sizes="auto"
            data-parent-fit="cover">
        </div>
        <noscript>
          <div class="banner-image fixed-height" style="background-image: url({{ section.settings.header_image | img_url: '2048x'}})"></div>
        </noscript>
      {% endif %}

      <div class="banner-image-text feature-page-title">
        {{ header_content }}
      </div>
    </div>
  {% else %}
    <div class="feature-page-title">
      {{ header_content }}
    </div>
  {% endif %}

  <div class="container">
    <div id="main" class="content-main" role="main">
      {% assign num_per_page = section.settings.products_per_row_int | times: 4 %}
      {% paginate collection.products by num_per_page %}
 

        {% if section.settings.enable_filtering and collection.filters != blank %}
              <form id="FacetFiltersForm" class="facets" method="get" data-ajax>
                {% for filter in collection.filters %}
                  <div class="facet facet--{{ filter.label | handle }}"> 
                    {% if filter.type != 'price_range' %} 
                       <label class="facet__label">{{ filter.label }}</label>  
                    {% endif %}
                    {% if filter.type == 'list'%}
                      <ul class="facet__list">
                        {% for value in filter.values %}
                          <li>
                            <label>
                              <input type="checkbox"
                                    name="{{ filter.param_name }}"
                                    value="{{ value.value }}"
                                    {% if value.active %}checked{% endif %}
                                    {% if value.count == 0 and value.active == false %}disabled{% endif %}>
                              {{ value.label }} ({{ value.count }})
                            </label>
                          </li>
                        {% endfor %}
                      </ul>
                    {% endif %}

                  {% comment %}   {% if filter.type == 'price_range' %}
                      <div class="facet__price">
                        <label>{{ 'collections.filtering.from' | t }}</label>
                        <input name="{{ filter.min_value.param_name }}"
                              type="number"
                              min="{{ filter.range_min }}"
                              max="{{ filter.range_max }}"
                              value="{{ filter.min_value.value | default: '' }}">
                        <label>{{ 'collections.filtering.to' | t }}</label>
                        <input name="{{ filter.max_value.param_name }}"
                              type="number"
                              min="{{ filter.range_min }}"
                              max="{{ filter.range_max }}"
                              value="{{ filter.max_value.value | default: '' }}">
                      </div>
                    {% endif %} {% endcomment %}
                  </div>
                {% endfor %}
              </form>
            {% endif %}


      <div class="grid grid--row-gutters product-list" data-products> 
        {% for product in collection.products %}
          {% include 'product-grid-item' %}
        {% else %}
          <p class="product-list__no-results"><em>{{ 'collections.general.no_matches' | t }}</em></p>
        {% endfor %}
      </div>

      {% include 'pagination' %}

      {% endpaginate %}
    </div>
  </div>
</div>


{% schema %}
  {
    "name": "Collection page",
    "settings": [
      {
        "type": "range",
        "id": "products_per_row_int",
        "min": 2,
        "max": 5,
        "step": 1,
        "label": "Number of products per row",
        "default": 4
      },
        {
      "type": "checkbox",
      "id": "enable_filtering",
      "default": true,
      "label": "Filtro"
      },
      {
        "type": "checkbox",
        "id": "show_tags",
        "label": "Show tags",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "coll_show_sort",
        "label": "Show sorting dropdown",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "coll_show_feat",
        "label": "Show 'Featured' option in sorting dropdown",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "grid_show_vendor",
        "label": "Show product vendor",
        "default": false
      },
      {
        "type": "header",
        "content": "Header image"
      },
      {
        "type": "paragraph",
        "content": "Shown on all collection pages"
      },
      {
        "type": "image_picker",
        "id": "header_image",
        "label": "Image"
      },
      {
        "type": "header",
        "content": "Collection-specific header images"
      },
      {
        "type": "checkbox",
        "id": "head_img_coll_handled",
        "label": "Enable",
        "default": false
      },
      {
        "type": "paragraph",
        "content": "You will need to [upload an image file](\/admin\/settings\/files) with the filename 'collection-header-handle.jpg', where 'handle' is the [handle](http:\/\/docs.shopify.com\/themes\/liquid-variables\/handle) of the collection."
      },
      {
        "type": "paragraph",
        "content": "If you do this, you will need to upload an image for every collection on your store, or it will encounter missing-file errors."
      } 
    ]
  }
{% endschema %}
